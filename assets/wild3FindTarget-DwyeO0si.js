import{S as ae,c as N,a as se,b as ne,d as ie,e as re,i as O,u as oe,f as L,R as u,j as n,F as V,T as W,g as $,h as G,p as le,k as D,r as E,s as de,l as me,o as ue,m as ce,n as pe,q as p,t as f,v as he,w as M,x as T,y as _e,z as be,A,B as R,C as z,D as xe,N as ge,E as y,G as S,H as g,_ as I,I as fe,J as Se,K as Ie,L as ke,M as Me}from"./index-LMy6lBSP.js";import{i as je,g as v,a as ye,b as we,c as Pe,u as w,f as H,d as q,l as Fe,e as Le,h as K,j as Re,k as ve,w as U,m as J,n as Y,o as Q,p as Te,q as Ae}from"./wild3GameData-Cl8AI9mf.js";var Ce=Math.min;function Ne(e,a,s){for(var t=se,i=e[0].length,l=e.length,r=l,h=Array(l),_=1/0,c=[];r--;){var d=e[r];_=Ce(d.length,_),h[r]=i>=120&&d.length>=120?new ae(r&&d):void 0}d=e[0];var o=-1,m=h[0];e:for(;++o<i&&c.length<_;){var b=d[o],x=b;if(b=b!==0?b:0,!(m?N(m,x):t(c,x))){for(r=l;--r;){var j=h[r];if(!(j?N(j,x):t(e[r],x)))continue e}m&&m.push(x),c.push(b)}}return c}function Oe(e){return je(e)?e:[]}var P=ne(function(e){var a=ie(e,Oe);return a.length&&a[0]===e[0]?Ne(a):[]});function Be(e,a,s,t){return e==null?[]:(O(a)||(a=a==null?[]:[a]),s=s,O(s)||(s=s==null?[]:[s]),re(e,a,s))}const X=["Wild1","Wild2","Wild3","Wild4","Wild5"],C=Pe(),Z=ke(!1),Ve=ue({species:I(Se),tid:S().int().min(0).max(65535),sid:S().int().min(0).max(65535),maps:g(fe()).min(1),recommendedSetups:y(),leadIdxs:g(S().int().min(0).max(v.length-1)).min(1),actions:g(I(Q)).min(1),roamerStates:g(I(Y)).min(1),massOutbreakStates:g(I(U)).min(1),feebasStates:g(I(J)).min(1),methods:g(I(X)).min(1),initial_advances:S().int().min(0).max(4294967295),max_advances:S().int().min(0).max(4294967295),max_result_count:S().int().min(1),rngManipulatedLeadPid:y(),mergeSimilarResults:y(),generate_even_if_impossible:y()}).extend(Ie.shape).extend(Ae.shape),We=()=>({species:"Abra",tid:0,sid:0,maps:[],leadIdxs:v.map((e,a)=>a),recommendedSetups:!0,methods:["Wild1","Wild2","Wild4"],actions:[...Q],roamerStates:[...Y],feebasStates:[...J],massOutbreakStates:[...U],initial_advances:1e3,max_advances:1e7,max_result_count:20,rngManipulatedLeadPid:!1,mergeSimilarResults:!0,generate_even_if_impossible:!1,..._e(),...ve()}),$e=e=>{const a=Me(D,e);return[{label:"Species",input:n.jsx(p,{name:"species",options:f(C.species)})},...pe({gender:a}),...we({max_size:he(e)})]},ee=e=>{const a=C.mapSetupsBySpecies.get(e)??[];return{maps:a.map(s=>s.map_data.map_id),actions:w(a.flatMap(s=>s.actions)),roamerStates:w(a.flatMap(s=>s.roamer_states)),massOutbreakStates:w(a.flatMap(s=>s.mass_outbreak_states)),feebasStates:w(a.flatMap(s=>s.feebas_states))}},Ge=()=>{const[,e]=G(Z);return n.jsx(T,{name:"rngManipulatedLeadPid",onChange:a=>{e(a)}})},De=(e,a,s)=>{const t=ee(e);return[{label:"Target Species",input:e},{label:"TID",input:n.jsx(M,{name:"tid",numType:"decimal",disabled:!a})},{label:"SID",input:n.jsx(M,{name:"sid",numType:"decimal",disabled:!a})},{label:"Recommended Setups?",input:n.jsx(T,{name:"recommendedSetups"})},...s?[]:[{label:"Actions",input:n.jsx(p,{name:"actions",options:f(t.actions,H),mode:"multiple",fullWidth:!0,selectAllNoneButtons:!0})},{label:"Maps",input:n.jsx(p,{name:"maps",options:f(t.maps,q),mode:"multiple",fullWidth:!0,selectAllNoneButtons:!0})},{label:"Leads",input:n.jsx(p,{name:"leadIdxs",options:Fe,mode:"multiple",selectAllNoneButtons:!0})},...t.roamerStates.length>1?[{label:"Roamer states",input:n.jsx(p,{name:"roamerStates",options:f(t.roamerStates,Le),mode:"multiple"})}]:[],...t.massOutbreakStates.length>1?[{label:"Mass outbreak states",input:n.jsx(p,{name:"roamerStates",options:f(t.massOutbreakStates,K),mode:"multiple",selectAllNoneButtons:!0})}]:[],...t.feebasStates.length>1?[{label:"Feebas states",input:n.jsx(p,{name:"feebasStates",options:f(t.feebasStates,Re),mode:"multiple"})}]:[]],{label:"Methods",input:n.jsx(p,{name:"methods",options:f(X),mode:"multiple"})},{label:"RNG-manipulated lead PID",input:n.jsx(Ge,{})},{label:"Initial advances",input:n.jsx(M,{name:"initial_advances",numType:"decimal"})},{label:"Max advances",input:n.jsx(M,{name:"max_advances",numType:"decimal"})},{label:"Max result count",input:n.jsx(M,{name:"max_result_count",numType:"decimal"})},{label:"Display results with 0% likelihood",input:n.jsx(T,{name:"generate_even_if_impossible"})}]},Ee=()=>{const{setFieldValue:e}=oe(),a=L({name:"species"}),s=u.useMemo(()=>$e(a),[a]);return u.useEffect(()=>{const t=ee(a);e("maps",t.maps),e("actions",t.actions),e("roamerStates",t.roamerStates),e("massOutbreakStates",t.massOutbreakStates),e("feebasStates",t.feebasStates)},[a,e]),n.jsxs(V,{vertical:!0,gap:8,children:[n.jsx(W.Title,{level:5,p:0,m:0,children:"Target PokÃ©mon"}),n.jsx($,{fields:s})]})},ze=()=>{const e=L({name:"species"}),a=L({name:"filter_shiny"}),s=L({name:"recommendedSetups"}),t=u.useMemo(()=>De(e,a,s),[e,a,s]);return n.jsxs(V,{vertical:!0,gap:8,children:[n.jsx(W.Title,{level:5,p:0,m:0,children:"Considered Setups"}),n.jsx($,{fields:t})]})},F=(e,a)=>{const s=A(e.method_probability),t=e.pre_sweet_scent_cycle_range.start+e.pre_sweet_scent_cycle_range.len,i=t===0?`Method ${a} can't be triggered.`:`Method ${a} is triggered if the cycle counter is between ${e.pre_sweet_scent_cycle_range.start} and ${t}.`;return n.jsx(R,{title:i,children:n.jsx("div",{children:s})})},He=({rngManipulatedLeadPid:e,showMassOutbreak:a})=>{const s=[];return s.push({title:"Advances",dataIndex:"advance",monospace:!0,render:t=>{const i=(t/59.7275/60).toFixed(1);return n.jsx(R,{title:`~${i} min`,children:n.jsx("div",{children:z(t)})})}},{title:"Map",dataIndex:"mapName"},{title:"Player action",dataIndex:"actionName"},...a?[{title:"Mass outbreak",dataIndex:"mass_outbreak_state",render:K}]:[]),e||s.push({title:n.jsxs(n.Fragment,{children:["Method ",n.jsx("br",{}),"Likelihood"]}),key:"<>Method <br />Likelihood</>",dataIndex:"cycle_data_by_lead",render:(t,i)=>{const l=(()=>{if(t==null)return"";const r=t.common_lower_lead.method_probability<t.common_upper_lead.method_probability?t.common_lower_lead:t.common_upper_lead;return A(r.method_probability)})();return n.jsx(R,{title:`Method ${i.method}`,children:n.jsx("div",{children:l})})}}),s.push({title:"Lead",dataIndex:"lead",render:Te}),e&&s.push({title:"Ideal Lead Speed",dataIndex:"cycle_data_by_lead",render:(t,i)=>{if(t==null||i.lead==="Egg")return"";if(t.ideal_lead.method_probability===t.slowest_lead.method_probability&&t.ideal_lead.method_probability===t.fastest_lead.method_probability)return"Any";const l=t.ideal_lead.lead_pid_cycle_count;return xe(l).with(18,()=>"Fastest").with(900,()=>"Slowest").with(ge.number,()=>l+" cycles").exhaustive()}},{title:"Method Likelyhood by Lead Speed",type:"group",columns:[{title:"Ideal",dataIndex:"cycle_data_by_lead",render:(t,i)=>t==null?"":F(t.ideal_lead,i.method)},{title:"Fastest",dataIndex:"cycle_data_by_lead",render:(t,i)=>t==null?"":F(t.fastest_lead,i.method)},{title:"Common",dataIndex:"cycle_data_by_lead",render:(t,i)=>{if(t==null)return"";const l=t.common_lower_lead.method_probability<t.common_upper_lead.method_probability?t.common_lower_lead:t.common_upper_lead;return F(l,i.method)}},{title:"Slowest",dataIndex:"cycle_data_by_lead",render:(t,i)=>t==null?"":F(t.slowest_lead,i.method)}]}),s},qe=()=>[{title:"",dataIndex:"resultSetupInfos",render:e=>`${e.length} setup${e.length>1?"s":""}`},{title:"Likelihood",dataIndex:"resultSetupInfos",key:"best_likelihood",render:e=>{var a;return A(((a=e[0])==null?void 0:a.primaryLikelihood)??0)}},{title:"Advances",dataIndex:"earliestAdvance",monospace:!0,render:e=>{const a=(e/59.7275/60).toFixed(1);return n.jsx(R,{title:`~${a} min`,children:n.jsxs("div",{children:["~",z(e)]})})}},{title:"Nature",dataIndex:"nature"},{title:"Shiny",dataIndex:"shiny",render:e=>e?"Yes":"No"},{title:"IV",type:"group",columns:be},{title:"PID",dataIndex:"pid",monospace:!0,render:e=>e.toString(16).padStart(8,"0").toUpperCase()},{title:"Ability",dataIndex:"ability"},{title:"Gender",dataIndex:"gender"},{title:"Hidden Power",type:"group",columns:[{title:"Type",dataIndex:"hidden_power",render:e=>e.pokemon_type},{title:"Power",dataIndex:"hidden_power",render:e=>e.bp}]},{title:"PID speed",dataIndex:"pidCycleCount",render:e=>`${e} cycles`},{title:"Method",dataIndex:"method"}],Ke=e=>{const a=C.mapSetupsBySpecies.get(e.species)??[];return e.recommendedSetups?a:a.filter(s=>e.maps.includes(s.map_data.map_id)).map(s=>({map_data:s.map_data,actions:P(s.actions,e.actions),roamer_states:P(s.roamer_states,e.roamerStates),mass_outbreak_states:P(s.mass_outbreak_states,e.massOutbreakStates),feebas_states:P(s.feebas_states,e.feebasStates)}))};let B=0;const Ue=async(e,a,s)=>{if(e.length===0)return null;const t=e[0],i=await Promise.all(e.map(r=>{const h=a[r.map_idx],_=q(h.map_data.map_id),c=(()=>{const{cycle_data_by_lead:d}=r;return d==null?0:s?d.ideal_lead.method_probability:Math.min(d.common_lower_lead.method_probability,d.common_upper_lead.method_probability)})();return{...r,uid:B++,mapName:_,actionName:H(r.action),primaryLikelihood:c}})),l=Math.min(...e.map(r=>r.advance));return{...t,...t.ivs,earliestAdvance:l,uid:B++,pidCycleCount:await E.calculate_pid_speed(t.pid),resultSetupInfos:Be(i,["primaryLikelihood","advance","method","map_idx"],["desc","asc","asc","asc"])}},Qe=({game:e})=>{const[a,s]=u.useState([]),[t,i]=u.useState(null),[l]=G(Z),r=e==="emerald"?0:1440,h=u.useCallback(async o=>{const m=Ke(o),b=o.recommendedSetups?[...v]:o.leadIdxs.map(k=>v[k]),x={initial_seed:r,tid:o.tid,sid:o.sid,gender_ratio:D[o.species],initial_advances:o.initial_advances,max_advances:o.max_advances,max_result_count:o.max_result_count,filter:le(o),gen3_filter:ye(o,o.species),leads:b,map_setups:m,methods:o.methods,consider_cycles:!0,consider_rng_manipulated_lead_pid:o.rngManipulatedLeadPid,generate_even_if_impossible:o.generate_even_if_impossible},j=await E.search_wild3(x),te=await Promise.all(j.map(k=>Ue(k.vec,m,o.rngManipulatedLeadPid)));s(de(te.filter(k=>k!=null),"earliestAdvance")),i(null)},[r]),_=u.useMemo(()=>We(),[]),c=u.useMemo(()=>qe(),[]),d=u.useMemo(()=>{const o=t!=null&&t.resultSetupInfos.some(m=>m.mass_outbreak_state!=="Inactive");return He({rngManipulatedLeadPid:l,showMassOutbreak:o})},[l,t]);return n.jsxs(n.Fragment,{children:[n.jsxs(me,{columns:c,results:a,validationSchema:Ve,initialValues:_,onSubmit:h,submitTrackerId:"wild3_find_target",rowKey:"uid",onClickResultRow:i,children:[n.jsx(Ee,{}),n.jsx("br",{}),n.jsx(ze,{})]}),t!=null?n.jsx(ce,{columns:d,rowKey:"uid",dataSource:t.resultSetupInfos}):null]})};export{ze as SetupFilter,Ee as TargetMon,Qe as Wild3SearcherFindTarget};
